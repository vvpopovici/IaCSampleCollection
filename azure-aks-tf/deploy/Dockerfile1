# syntax=docker/dockerfile:1
# check=skip=SecretsUsedInArgOrEnv

ARG VVPSOLL_LIB_IMAGE=vvpsoll-lib:latest
FROM $VVPSOLL_LIB_IMAGE AS vvpsoll_lib


FROM python:3.10-slim

WORKDIR /app

RUN apt-get update && apt-get install -y libgl1 libglib2.0-0 && apt-get clean && rm -rf /var/lib/apt/lists/*

ENV SERVICEBUS_CONNECTION_STRING='' ANALYSIS_REQUEST_QUEUE='' ANALYSIS_RESPONSE_QUEUE='' MOCK_ASSESSMENT=''
ENV MODELS_BASE_PATH="/_models" VVP_ML_WORKSPACE="/vvp-ml"

COPY ./ ./
COPY --from=vvpsoll_lib /vvpsoll_lib/dist/ /app/dist/
RUN pip install -r requirements.txt --no-cache-dir --progress-bar=off --root-user-action=ignore --disable-pip-version-check --no-python-version-warning --trusted-host download.openmmlab.com

VOLUME [ "/_models", "/vvp-ml" ]

CMD ["python", "listener.py"]
