# syntax=docker/dockerfile:1
# check=skip=SecretsUsedInArgOrEnv

FROM python:3.10-slim

ARG APP_VERSION=0.0.0
ENV APP_VERSION=${APP_VERSION}
WORKDIR /app
COPY . /app

RUN pip install --no-cache-dir -r requirements.txt

ENV AZURE_CONNECTION_STRING='' SERVICEBUS_CONNECTION_STRING='' AZURE_ACCOUNT_NAME='' AZURE_ACCOUNT_KEY='' AZURE_CONTAINER_NAME='' REQUESTS_QUEUE_NAME='' RESPONSE_QUEUE_NAME='' LOCAL_STORAGE_DIR=''

HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 CMD curl -f http://localhost:8000/health || exit 1

EXPOSE 8000

CMD ["uvicorn", "upload_video_api.main:app", "--host", "0.0.0.0", "--port", "8000"]
